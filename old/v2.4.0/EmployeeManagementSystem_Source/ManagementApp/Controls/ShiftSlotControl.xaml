<UserControl x:Class="ManagementApp.Controls.ShiftSlotControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:converters="clr-namespace:ManagementApp.Converters"
             mc:Ignorable="d" 
             d:DesignHeight="150" d:DesignWidth="250">

    <UserControl.Resources>
        <converters:EmployeePhotoConverter x:Key="EmployeePhotoConverter"/>
        <BooleanToVisibilityConverter x:Key="BoolToVis"/>
    </UserControl.Resources>

    <Border x:Name="MainBorder" 
            BorderThickness="0" 
            Background="Transparent"
            AllowDrop="True"
            DragOver="Border_DragOver"
            Drop="Border_Drop"
            MinHeight="100"
            Padding="5">
        
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <!-- Shift Title -->
            <TextBlock x:Name="TitleBlock" 
                       Grid.Row="0"
                       Foreground="Gray" 
                       FontSize="10" 
                       HorizontalAlignment="Center" 
                       Margin="0,0,0,5"/>

            <!-- Content Area - AllowDrop so drop is received when EmptyState is hit-test invisible -->
            <Grid Grid.Row="1" AllowDrop="True" DragOver="Border_DragOver" Drop="Border_Drop" DragLeave="Border_DragLeave">
                <!-- 1. Assigned Employee -->
                <Border x:Name="EmployeeCard" 
                        Background="White" 
                        BorderBrush="#E0E0E0" 
                        BorderThickness="1" 
                        CornerRadius="4" 
                        Padding="5"
                        Visibility="Collapsed"
                        PreviewMouseLeftButtonDown="Element_PreviewMouseLeftButtonDown">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        
                        <!-- Photo -->
                        <Ellipse Grid.Column="0" Width="40" Height="40" Margin="0,0,10,0">
                            <Ellipse.Fill>
                                <ImageBrush x:Name="EmployeePhotoBrush" Stretch="UniformToFill"/>
                            </Ellipse.Fill>
                        </Ellipse>

                        <!-- Info -->
                        <StackPanel Grid.Column="1" VerticalAlignment="Center">
                            <TextBlock x:Name="EmployeeNameText" FontWeight="Bold" FontSize="12" TextTrimming="CharacterEllipsis"/>
                            <TextBlock x:Name="EmployeeIdText" Foreground="Gray" FontSize="10"/>
                            <!-- Labels container: compact list below photo, scroll if many (never fills whole slot) -->
                            <ScrollViewer Margin="0,5,0,0" MaxHeight="52" VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
                                <ItemsControl x:Name="LabelsList">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <Border Background="#EEE" CornerRadius="2" Padding="4,1" Margin="0,1"
                                                    PreviewMouseLeftButtonDown="Label_PreviewMouseLeftButtonDown"
                                                    MouseMove="Label_MouseMove">
                                                <Border.ContextMenu>
                                                    <ContextMenu>
                                                        <MenuItem Header="{converters:Res menu_remove}" Click="LabelRemove_Click"/>
                                                    </ContextMenu>
                                                </Border.ContextMenu>
                                                <TextBlock Text="{Binding Text}" FontSize="9"/>
                                            </Border>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </ScrollViewer>
                        </StackPanel>
                    </Grid>
                </Border>

                <!-- 2. Status Card -->
                <Border x:Name="StatusCard" 
                        CornerRadius="4" 
                        Padding="10"
                        Visibility="Collapsed"
                        PreviewMouseLeftButtonDown="Element_PreviewMouseLeftButtonDown">
                    <TextBlock x:Name="StatusText" 
                               Foreground="White" 
                               FontWeight="Bold" 
                               HorizontalAlignment="Center" 
                               VerticalAlignment="Center"
                               TextWrapping="Wrap"
                               TextAlignment="Center"/>
                </Border>

                <!-- 3. Empty State - IsHitTestVisible=False so drop goes to MainBorder -->
                <Grid x:Name="EmptyState" Visibility="Visible" IsHitTestVisible="False">
                    <Rectangle Stroke="#EEE" 
                               StrokeThickness="1" 
                               StrokeDashArray="4 2" 
                               RadiusX="4" 
                               RadiusY="4"/>
                    <TextBlock Text="{converters:Res cell_empty}" 
                               Foreground="#CCC" 
                               HorizontalAlignment="Center" 
                               VerticalAlignment="Center"/>
                </Grid>
            </Grid>
        </Grid>
    </Border>
</UserControl>
